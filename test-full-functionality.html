<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ RPA</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .button { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 3px; }
        .button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
        .success { border-left: 5px solid #28a745; }
        .error { border-left: 5px solid #dc3545; }
        .logs { font-family: monospace; font-size: 12px; max-height: 300px; overflow-y: auto; background: #1e1e1e; color: #fff; padding: 10px; }
    </style>
</head>
<body>
    <h1>üß™ –¢–µ—Å—Ç —Ä–µ–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ RPA</h1>
    
    <div class="test-section">
        <h3>1. –¢–µ—Å—Ç –ø–æ–ª—É—á–µ–Ω–∏—è Multilogin —Ç–æ–∫–µ–Ω–æ–≤</h3>
        <button class="button" onclick="testMultiloginTokens()">–ü–æ–ª—É—á–∏—Ç—å —Ç–æ–∫–µ–Ω—ã Multilogin</button>
        <div id="multilogin-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. –¢–µ—Å—Ç —Å–æ–∑–¥–∞–Ω–∏—è Multilogin –ø—Ä–æ—Ñ–∏–ª—è</h3>
        <button class="button" onclick="testMultiloginProfile()">–°–æ–∑–¥–∞—Ç—å –ø—Ä–æ—Ñ–∏–ª—å</button>
        <div id="profile-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. –¢–µ—Å—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è RPA –∑–∞–¥–∞—á–∏</h3>
        <button class="button" onclick="testRPATask()">–í—ã–ø–æ–ª–Ω–∏—Ç—å RPA –∑–∞–¥–∞—á—É</button>
        <div id="rpa-result" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. –õ–æ–≥–∏</h3>
        <div id="logs" class="logs"></div>
    </div>

    <script>
        const SUPABASE_URL = 'https://izmgzstdgoswlozinmyk.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml6bWd6c3RkZ29zd2xvemlubXlrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTAxNTk3NzksImV4cCI6MjA2NTczNTc3OX0.5BEISZmOjbbnBCPlqVyvuHiEDf9NOhaHh33U07UNzVU';

        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'color: #ff6b6b' : type === 'success' ? 'color: #51cf66' : 'color: #74c0fc';
            logs.innerHTML += `<div style="${className}">[${timestamp}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
            console.log(`[${type.toUpperCase()}] ${message}`);
        }

        async function callSupabaseFunction(functionName, body = {}) {
            try {
                log(`üöÄ –í—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ ${functionName}...`);
                
                const response = await fetch(`${SUPABASE_URL}/functions/v1/${functionName}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${SUPABASE_ANON_KEY}`,
                    },
                    body: JSON.stringify(body)
                });

                const responseText = await response.text();
                log(`üì° –û—Ç–≤–µ—Ç ${functionName}: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${responseText}`);
                }

                const result = JSON.parse(responseText);
                log(`‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç ${functionName}: ${JSON.stringify(result, null, 2)}`, 'success');
                return result;
                
            } catch (error) {
                log(`‚ùå –û—à–∏–±–∫–∞ ${functionName}: ${error.message}`, 'error');
                throw error;
            }
        }

        async function testMultiloginTokens() {
            const resultDiv = document.getElementById('multilogin-result');
            try {
                resultDiv.innerHTML = '<div>‚è≥ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤...</div>';
                
                const result = await callSupabaseFunction('multilogin-token-manager', {});
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ –¢–æ–∫–µ–Ω—ã –ø–æ–ª—É—á–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!</strong><br>
                        <small>Email: ${result.email || 'N/A'}</small><br>
                        <small>–¢–æ–∫–µ–Ω: ${result.token ? result.token.substring(0, 20) + '...' : 'N/A'}</small><br>
                        <small>–ò—Å—Ç–µ–∫–∞–µ—Ç: ${result.expires_at || 'N/A'}</small>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><strong>‚ùå –û—à–∏–±–∫–∞:</strong> ${error.message}</div>`;
            }
        }

        async function testMultiloginProfile() {
            const resultDiv = document.getElementById('profile-result');
            try {
                resultDiv.innerHTML = '<div>‚è≥ –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è...</div>';
                
                const result = await callSupabaseFunction('multilogin-api', {
                    platform: 'instagram',
                    username: 'test_user_' + Date.now(),
                    password: 'test_password'
                });
                
                resultDiv.innerHTML = `
                    <div class="success">
                        <strong>‚úÖ –ü—Ä–æ—Ñ–∏–ª—å —Å–æ–∑–¥–∞–Ω!</strong><br>
                        <small>ID –ø—Ä–æ—Ñ–∏–ª—è: ${result.profile_id || 'N/A'}</small><br>
                        <small>–°—Ç–∞—Ç—É—Å: ${result.success ? '–£—Å–ø–µ—à–Ω–æ' : '–û—à–∏–±–∫–∞'}</small>
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><strong>‚ùå –û—à–∏–±–∫–∞:</strong> ${error.message}</div>`;
            }
        }

        async function testRPATask() {
            const resultDiv = document.getElementById('rpa-result');
            try {
                resultDiv.innerHTML = '<div>‚è≥ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ RPA –∑–∞–¥–∞—á–∏...</div>';
                
                const taskId = 'test_' + Date.now();
                const task = {
                    taskId: taskId,
                    url: 'https://httpbin.org/get',
                    actions: [
                        { type: 'navigate', url: 'https://httpbin.org/get' },
                        { type: 'wait', duration: 2000 },
                        { type: 'screenshot' }
                    ],
                    metadata: {
                        platform: 'test',
                        account: { username: 'test_user' }
                    },
                    timeout: 30
                };
                
                const result = await callSupabaseFunction('rpa-task', { task });
                
                resultDiv.innerHTML = `
                    <div class="${result.success ? 'success' : 'error'}">
                        <strong>${result.success ? '‚úÖ' : '‚ùå'} RPA –∑–∞–¥–∞—á–∞ ${result.success ? '–≤—ã–ø–æ–ª–Ω–µ–Ω–∞' : '–ø—Ä–æ–≤–∞–ª–µ–Ω–∞'}!</strong><br>
                        <small>Task ID: ${result.taskId || 'N/A'}</small><br>
                        <small>–°–æ–æ–±—â–µ–Ω–∏–µ: ${result.result?.message || result.message || 'N/A'}</small><br>
                        <small>–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ${result.result?.executionTime || 0}–º—Å</small>
                        ${result.result?.data?.screenshot_urls ? `<br><small>–°–∫—Ä–∏–Ω—à–æ—Ç—ã: ${result.result.data.screenshot_urls.length}</small>` : ''}
                    </div>
                `;
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><strong>‚ùå –û—à–∏–±–∫–∞:</strong> ${error.message}</div>`;
            }
        }

        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        log('üéØ –°–∏—Å—Ç–µ–º–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—É—â–µ–Ω–∞');
        log('üìã –ì–æ—Ç–æ–≤–∞ –∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é —Ä–µ–∞–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏');
    </script>
</body>
</html>